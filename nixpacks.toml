# nixpacks.toml
#
# 1) Setup: install Node.js
[phases.setup]
nodejs.setup = "18.x"
nixPkgs = ["nodejs", "npm"]

# 2) Install dependencies for both packages
[phases.install]
cmds = [
  "cd backend && npm ci",
  "cd frontend && npm ci"
]

# 3) Build only the frontend
[phases.build]
cmds = [
  "cd frontend && npm run build"
]

# 4) Start the backend (which will also need to serve or proxy your built frontend, if desired)
[start]
cmd = "cd backend && node src/app.js"

# 5) Tell Fly which port your app is on
[defaults]
port = 4000

[deploy]
startCommand = "cd backend && node src/app.js"
